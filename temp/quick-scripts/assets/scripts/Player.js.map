{"version":3,"sources":["Player.js"],"names":["cc","Class","extends","Component","properties","jumpHeight","jumpDuration","maxMoveSpeed","accel","jumpAudio","default","type","AudioClip","setJumpAction","jumpUp","moveBy","v2","easing","easeCubicActionOut","jumpDown","easeCubicActionIn","callback","callFunc","playJumpSound","repeatForever","sequence","onKeyDown","event","keyCode","macro","KEY","a","accLeft","d","accRight","onKeyUp","audioEngine","playEffect","getCenterPos","centerPos","node","x","y","height","startMoveAt","pos","xSpeed","setPosition","runAction","jumpAction","stopMove","stopAllActions","onLoad","systemEvent","on","SystemEvent","EventType","KEY_DOWN","KEY_UP","onDestroy","off","start","update","dt","Math","abs"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEAA,GAAGC,KAAH,CAAS;AACRC,UAASF,GAAGG,SADJ;;AAGRC,aAAY;AACXC,cAAY,CADD,EACI;AACfC,gBAAc,CAFH,EAEM;AACjBC,gBAAc,CAHH,EAGM;AACjBC,SAAO,CAJI,EAID;AACV;AACAC,aAAW;AACVC,YAAS,IADC;AAEVC,SAAMX,GAAGY;AAFC;AANA,EAHJ;AAcRC,cAdQ,2BAcQ;AACf;AACA,MAAMC,SAASd,GAAGe,MAAH,CAAU,KAAKT,YAAf,EAA6BN,GAAGgB,EAAH,CAAM,CAAN,EAAS,KAAKX,UAAd,CAA7B,EAAwDY,MAAxD,CAA+DjB,GAAGkB,kBAAH,EAA/D,CAAf;AACA;AACA,MAAMC,WAAWnB,GAAGe,MAAH,CAAU,KAAKT,YAAf,EAA6BN,GAAGgB,EAAH,CAAM,CAAN,EAAS,CAAC,KAAKX,UAAf,CAA7B,EAAyDY,MAAzD,CAAgEjB,GAAGoB,iBAAH,EAAhE,CAAjB;AACA;AACA,MAAIC,WAAWrB,GAAGsB,QAAH,CAAY,KAAKC,aAAjB,EAAgC,IAAhC,CAAf;AACA;AACA,SAAOvB,GAAGwB,aAAH,CAAiBxB,GAAGyB,QAAH,CAAYX,MAAZ,EAAoBK,QAApB,EAA8BE,QAA9B,CAAjB,CAAP;AACA,EAvBO;AAwBRK,UAxBQ,qBAwBEC,KAxBF,EAwBS;AAChB,UAAQA,MAAMC,OAAd;AACC,QAAK5B,GAAG6B,KAAH,CAASC,GAAT,CAAaC,CAAlB;AACC,SAAKC,OAAL,GAAe,IAAf;AACA;AACD,QAAKhC,GAAG6B,KAAH,CAASC,GAAT,CAAaG,CAAlB;AACC,SAAKC,QAAL,GAAgB,IAAhB;AACA;AACD;AACC;AARF;AAUA,EAnCO;AAoCRC,QApCQ,mBAoCAR,KApCA,EAoCO;AACd,UAAQA,MAAMC,OAAd;AACC,QAAK5B,GAAG6B,KAAH,CAASC,GAAT,CAAaC,CAAlB;AACC,SAAKC,OAAL,GAAe,KAAf;AACA;AACD,QAAKhC,GAAG6B,KAAH,CAASC,GAAT,CAAaG,CAAlB;AACC,SAAKC,QAAL,GAAgB,KAAhB;AACA;AACD;AACC;AARF;AAUA,EA/CO;AAgDRX,cAhDQ,2BAgDQ;AACfvB,KAAGoC,WAAH,CAAeC,UAAf,CAA0B,KAAK5B,SAA/B,EAA0C,KAA1C;AACA,EAlDO;AAoDR6B,aApDQ,0BAoDO;AACd,MAAIC,YAAYvC,GAAGgB,EAAH,CAAM,KAAKwB,IAAL,CAAUC,CAAhB,EAAmB,KAAKD,IAAL,CAAUE,CAAV,GAAc,KAAKF,IAAL,CAAUG,MAAV,GAAiB,CAAlD,CAAhB;AACA,SAAOJ,SAAP;AACD,EAvDQ;;;AAyDR;AACAK,YA1DQ,uBA0DIC,GA1DJ,EA0DS;AAChB,OAAKC,MAAL,GAAc,CAAd;AACA,OAAKN,IAAL,CAAUO,WAAV,CAAsBF,GAAtB;AACA,OAAKL,IAAL,CAAUQ,SAAV,CAAoB,KAAKC,UAAzB;AACA,EA9DO;;;AAgER;AACAC,WAAU,oBAAY;AACrB,OAAKV,IAAL,CAAUW,cAAV;AACA,EAnEO;;AAqERC,SAAQ,kBAAY;AACnB;AACA,OAAKH,UAAL,GAAkB,KAAKpC,aAAL,EAAlB;AACA;;AAEA;AACA,OAAKmB,OAAL,GAAe,KAAf;AACA,OAAKE,QAAL,GAAgB,KAAhB;AACA;AACA,OAAKY,MAAL,GAAc,CAAd;;AAEA;AACA9C,KAAGqD,WAAH,CAAeC,EAAf,CAAkBtD,GAAGuD,WAAH,CAAeC,SAAf,CAAyBC,QAA3C,EAAqD,KAAK/B,SAA1D,EAAqE,IAArE;AACA1B,KAAGqD,WAAH,CAAeC,EAAf,CAAkBtD,GAAGuD,WAAH,CAAeC,SAAf,CAAyBE,MAA3C,EAAmD,KAAKvB,OAAxD,EAAiE,IAAjE;AACA,EAnFO;;AAqFRwB,UArFQ,uBAqFI;AACX;AACA3D,KAAGqD,WAAH,CAAeO,GAAf,CAAmB5D,GAAGuD,WAAH,CAAeC,SAAf,CAAyBC,QAA5C,EAAsD,KAAK/B,SAA3D,EAAsE,IAAtE;AACA1B,KAAGqD,WAAH,CAAeO,GAAf,CAAmB5D,GAAGuD,WAAH,CAAeC,SAAf,CAAyBE,MAA5C,EAAoD,KAAKvB,OAAzD,EAAkE,IAAlE;AACA,EAzFO;AA2FR0B,MA3FQ,mBA2FA,CAEP,CA7FO;AA+FRC,OA/FQ,kBA+FDC,EA/FC,EA+FG;AACV,MAAI,KAAK/B,OAAT,EAAkB;AACjB,QAAKc,MAAL,IAAe,KAAKtC,KAAL,GAAauD,EAA5B;AACA,GAFD,MAEO,IAAI,KAAK7B,QAAT,EAAmB;AACzB,QAAKY,MAAL,IAAe,KAAKtC,KAAL,GAAauD,EAA5B;AACA;;AAED;AACA,MAAIC,KAAKC,GAAL,CAAS,KAAKnB,MAAd,IAAwB,KAAKvC,YAAjC,EAA+C;AAC9C,QAAKuC,MAAL,GAAc,KAAKvC,YAAL,GAAoB,KAAKuC,MAAzB,GAAkCkB,KAAKC,GAAL,CAAS,KAAKnB,MAAd,CAAhD;AACA;;AAED;AACA,OAAKN,IAAL,CAAUC,CAAV,IAAe,KAAKK,MAAL,GAAciB,EAA7B;AACA;AA7GO,CAAT","file":"Player.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\r\n\r\ncc.Class({\r\n\textends: cc.Component,\r\n\r\n\tproperties: {\r\n\t\tjumpHeight: 0, // 跳跃高度\r\n\t\tjumpDuration: 0, // 跳跃持续时间\r\n\t\tmaxMoveSpeed: 0, // 最大移动速度\r\n\t\taccel: 0, // 加速度\r\n\t\t// 跳跃音效\r\n\t\tjumpAudio: {\r\n\t\t\tdefault: null,\r\n\t\t\ttype: cc.AudioClip\r\n\t\t}\r\n\t},\r\n\tsetJumpAction() {\r\n\t\t// 跳跃上升\r\n\t\tconst jumpUp = cc.moveBy(this.jumpDuration, cc.v2(0, this.jumpHeight)).easing(cc.easeCubicActionOut())\r\n\t\t// 下降\r\n\t\tconst jumpDown = cc.moveBy(this.jumpDuration, cc.v2(0, -this.jumpHeight)).easing(cc.easeCubicActionIn())\r\n\t\t// 添加回调函数 用于在动作结束后播放音频\r\n\t\tvar callback = cc.callFunc(this.playJumpSound, this)\r\n\t\t// 不断重复, 每次完成落地动作后 调用回调来播放声音\r\n\t\treturn cc.repeatForever(cc.sequence(jumpUp, jumpDown, callback));\r\n\t},\r\n\tonKeyDown(event) {\r\n\t\tswitch (event.keyCode) {\r\n\t\t\tcase cc.macro.KEY.a:\r\n\t\t\t\tthis.accLeft = true;\r\n\t\t\t\tbreak;\r\n\t\t\tcase cc.macro.KEY.d:\r\n\t\t\t\tthis.accRight = true;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t},\r\n\tonKeyUp(event) {\r\n\t\tswitch (event.keyCode) {\r\n\t\t\tcase cc.macro.KEY.a:\r\n\t\t\t\tthis.accLeft = false\r\n\t\t\t\tbreak;\r\n\t\t\tcase cc.macro.KEY.d:\r\n\t\t\t\tthis.accRight = false\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t},\r\n\tplayJumpSound() {\r\n\t\tcc.audioEngine.playEffect(this.jumpAudio, false);\r\n\t},\r\n\r\n\tgetCenterPos() {\r\n\t\tvar centerPos = cc.v2(this.node.x, this.node.y + this.node.height/2);\r\n\t\treturn centerPos;\r\n},\r\n\r\n\t// player 开始移动\r\n\tstartMoveAt(pos) {\r\n\t\tthis.xSpeed = 0;\r\n\t\tthis.node.setPosition(pos);\r\n\t\tthis.node.runAction(this.jumpAction);\r\n\t},\r\n\r\n\t// 停止移动\r\n\tstopMove: function () {\r\n\t\tthis.node.stopAllActions();\r\n\t},\r\n\r\n\tonLoad: function () {\r\n\t\t// 初始化跳跃动作\r\n\t\tthis.jumpAction = this.setJumpAction();\r\n\t\t// this.node.runAction(this.jumpAction);\r\n\r\n\t\t// 加速度方向开关\r\n\t\tthis.accLeft = false;\r\n\t\tthis.accRight = false;\r\n\t\t// 主角当前水平方向速度\r\n\t\tthis.xSpeed = 0;\r\n\r\n\t\t// 初始化键盘输入监听\r\n\t\tcc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n\t\tcc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\r\n\t},\r\n\r\n\tonDestroy() {\r\n\t\t// 取消键盘输入监听\r\n\t\tcc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n\t\tcc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\r\n\t},\r\n\r\n\tstart() {\r\n\r\n\t},\r\n\r\n\tupdate(dt) {\r\n\t\tif (this.accLeft) {\r\n\t\t\tthis.xSpeed -= this.accel * dt\r\n\t\t} else if (this.accRight) {\r\n\t\t\tthis.xSpeed += this.accel * dt\r\n\t\t}\r\n\r\n\t\t// 限制速度最大值\r\n\t\tif (Math.abs(this.xSpeed) > this.maxMoveSpeed) {\r\n\t\t\tthis.xSpeed = this.maxMoveSpeed * this.xSpeed / Math.abs(this.xSpeed)\r\n\t\t}\r\n\r\n\t\t// 根据速度更新位置\r\n\t\tthis.node.x += this.xSpeed * dt\r\n\t},\r\n});\r\n"]}