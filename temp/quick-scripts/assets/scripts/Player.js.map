{"version":3,"sources":["Player.js"],"names":["cc","Class","extends","Component","properties","jumpHeight","jumpDuration","maxMoveSpeed","accel","jumpAudio","default","type","AudioClip","onLoad","enabled","accLeft","accRight","xSpeed","minPosX","node","parent","width","maxPosX","jumpAction","setJumpAction","systemEvent","on","SystemEvent","EventType","KEY_DOWN","onKeyDown","KEY_UP","onKeyUp","touchReceiver","Canvas","instance","onTouchStart","onTouchEnd","onDestroy","off","event","keyCode","macro","KEY","a","left","d","right","touchLoc","getLocation","x","winSize","jumpUp","moveBy","v2","easing","easeCubicActionOut","jumpDown","easeCubicActionIn","callback","callFunc","playJumpSound","repeatForever","sequence","audioEngine","playEffect","getCenterPos","centerPos","y","height","startMoveAt","pos","setPosition","runAction","stopMove","stopAllActions","start","update","dt","Math","abs"],"mappings":"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","file":"Player.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\r\n\r\ncc.Class({\r\n\textends: cc.Component,\r\n\r\n\tproperties: {\r\n\t\tjumpHeight: 0, // 跳跃高度\r\n\t\tjumpDuration: 0, // 跳跃持续时间\r\n\t\tmaxMoveSpeed: 0, // 最大移动速度\r\n\t\taccel: 0, // 加速度\r\n\t\t// 跳跃音效\r\n\t\tjumpAudio: {\r\n\t\t\tdefault: null,\r\n\t\t\ttype: cc.AudioClip\r\n\t\t}\r\n\t},\r\n\r\n\tonLoad: function () {\r\n\t\tthis.enabled = false;\r\n\r\n\t\t// 加速度方向开关\r\n\t\tthis.accLeft = false;\r\n\t\tthis.accRight = false;\r\n\t\t// 主角当前水平方向速度\r\n\t\tthis.xSpeed = 0;\r\n\r\n\t\t// 获取屏幕边界\r\n\t\tthis.minPosX = -this.node.parent.width / 2;\r\n\t\tthis.maxPosX = this.node.parent.width / 2;\r\n\r\n\t\t// 初始化跳跃动作\r\n\t\tthis.jumpAction = this.setJumpAction();\r\n\t\t// this.node.runAction(this.jumpAction);\r\n\r\n\t\t// 初始化键盘输入监听\r\n\t\tcc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n\t\tcc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\r\n\r\n\t\t// 初始化触摸事件监听\r\n\t\tvar touchReceiver = cc.Canvas.instance.node;\r\n\t\ttouchReceiver.on('touchstart', this.onTouchStart, this);\r\n\t\ttouchReceiver.on('touchend', this.onTouchEnd, this);\r\n\t},\r\n\r\n\tonDestroy() {\r\n\t\t// 取消键盘输入监听\r\n\t\tcc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n\t\tcc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\r\n\r\n\t\t// 取消触摸事件监听\r\n\t\tvar touchReceiver = cc.Canvas.instance.node;\r\n\t\ttouchReceiver.off('touchstart', this.onTouchStart, this);\r\n\t\ttouchReceiver.off('touchend', this.onTouchEnd, this);\r\n\t},\r\n\r\n\tonKeyDown(event) {\r\n\t\t// console.log(event,'event')\r\n\t\t// console.log(cc.macro.KEY)\r\n\t\tswitch (event.keyCode) {\r\n\t\t\tcase cc.macro.KEY.a:\r\n\t\t\tcase cc.macro.KEY.left:\r\n\t\t\t\tthis.accLeft = true;\r\n\t\t\t\tthis.accRight = false\r\n\t\t\t\tbreak;\r\n\t\t\tcase cc.macro.KEY.d:\r\n\t\t\tcase cc.macro.KEY.right:\r\n\t\t\t\tthis.accRight = true;\r\n\t\t\t\tthis.accLeft = false;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t},\r\n\tonKeyUp(event) {\r\n\t\tswitch (event.keyCode) {\r\n\t\t\tcase cc.macro.KEY.a:\r\n\t\t\tcase cc.macro.KEY.left:\r\n\t\t\t\tthis.accLeft = false;\r\n\t\t\t\tbreak;\r\n\t\t\tcase cc.macro.KEY.d:\r\n\t\t\tcase cc.macro.KEY.right:\r\n\t\t\t\tthis.accRight = false;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t},\r\n\r\n\tonTouchStart(event) {\r\n\t\t// console.log(event, 'event')\r\n\t\tvar touchLoc = event.getLocation();\r\n\t\t// console.log(touchLoc, 'touchLoc')\r\n\t\tif (touchLoc.x >= cc.winSize.width / 2) {\r\n\t\t\tthis.accLeft = false;\r\n\t\t\tthis.accRight = true;\r\n\t\t} else {\r\n\t\t\tthis.accLeft = true;\r\n\t\t\tthis.accRight = false;\r\n\t\t}\r\n\t},\r\n\r\n\tonTouchEnd(event) {\r\n\t\tthis.accLeft = false;\r\n\t\tthis.accRight = false;\r\n\t},\r\n\r\n\tsetJumpAction() {\r\n\t\t// 跳跃上升\r\n\t\tconst jumpUp = cc.moveBy(this.jumpDuration, cc.v2(0, this.jumpHeight)).easing(cc.easeCubicActionOut())\r\n\t\t// 下降\r\n\t\tconst jumpDown = cc.moveBy(this.jumpDuration, cc.v2(0, -this.jumpHeight)).easing(cc.easeCubicActionIn())\r\n\t\t// 添加回调函数 用于在动作结束后播放音频\r\n\t\tvar callback = cc.callFunc(this.playJumpSound, this)\r\n\t\t// 不断重复, 每次完成落地动作后 调用回调来播放声音\r\n\t\treturn cc.repeatForever(cc.sequence(jumpUp, jumpDown, callback));\r\n\t},\r\n\tplayJumpSound() {\r\n\t\tcc.audioEngine.playEffect(this.jumpAudio, false);\r\n\t},\r\n\r\n\tgetCenterPos() {\r\n\t\tvar centerPos = cc.v2(this.node.x, this.node.y + this.node.height / 2);\r\n\t\treturn centerPos;\r\n\t},\r\n\r\n\t// player 开始移动\r\n\tstartMoveAt(pos) {\r\n\t\tthis.enabled = true;\r\n\t\tthis.xSpeed = 0;\r\n\t\tthis.node.setPosition(pos);\r\n\t\tthis.node.runAction(this.jumpAction);\r\n\t},\r\n\r\n\t// 停止移动\r\n\tstopMove: function () {\r\n\t\tthis.node.stopAllActions();\r\n\t\tthis.enabled = false;\r\n\t},\r\n\r\n\tstart() {\r\n\r\n\t},\r\n\r\n\tupdate(dt) {\r\n\t\t// 根据当前加速度方向每帧更新速度\r\n\t\tif (this.accLeft) {\r\n\t\t\tthis.xSpeed -= this.accel * dt\r\n\t\t} else if (this.accRight) {\r\n\t\t\tthis.xSpeed += this.accel * dt\r\n\t\t}\r\n\r\n\t\t// 限制速度最大值\r\n\t\tif (Math.abs(this.xSpeed) > this.maxMoveSpeed) {\r\n\t\t\tthis.xSpeed = this.maxMoveSpeed * this.xSpeed / Math.abs(this.xSpeed)\r\n\t\t}\r\n\r\n\t\t// 根据速度更新 player 位置\r\n\t\tthis.node.x += this.xSpeed * dt\r\n\r\n\t\t// 限制 player 在屏幕内移动\r\n\t\tif (this.node.x >= this.node.parent.width / 2) {\r\n\t\t\tthis.node.x = this.node.parent.width / 2\r\n\t\t\tthis.xSpeed = 0;\r\n\t\t} else if (this.node.x < -this.node.parent.width / 2) {\r\n\t\t\tthis.node.x = -this.node.parent.width / 2\r\n\t\t\tthis.xSpeed = 0;\r\n\t\t}\r\n\t},\r\n});\r\n"]}