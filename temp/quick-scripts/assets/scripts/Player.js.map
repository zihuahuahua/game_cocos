{"version":3,"sources":["Player.js"],"names":["cc","Class","extends","Component","properties","jumpHeight","jumpDuration","maxMoveSpeed","accel","jumpAudio","default","type","AudioClip","onLoad","enabled","accLeft","accRight","xSpeed","minPosX","node","parent","width","maxPosX","jumpAction","setJumpAction","systemEvent","on","SystemEvent","EventType","KEY_DOWN","onKeyDown","KEY_UP","onKeyUp","onDestroy","off","event","keyCode","macro","KEY","a","left","d","right","onTouchStart","touchLoc","getLocation","console","log","x","winSize","onTouchEnd","jumpUp","moveBy","v2","easing","easeCubicActionOut","jumpDown","easeCubicActionIn","callback","callFunc","playJumpSound","repeatForever","sequence","audioEngine","playEffect","getCenterPos","centerPos","y","height","startMoveAt","pos","setPosition","runAction","stopMove","stopAllActions","start","update","dt","Math","abs"],"mappings":"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","file":"Player.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\r\n\r\ncc.Class({\r\n\textends: cc.Component,\r\n\r\n\tproperties: {\r\n\t\tjumpHeight: 0, // 跳跃高度\r\n\t\tjumpDuration: 0, // 跳跃持续时间\r\n\t\tmaxMoveSpeed: 0, // 最大移动速度\r\n\t\taccel: 0, // 加速度\r\n\t\t// 跳跃音效\r\n\t\tjumpAudio: {\r\n\t\t\tdefault: null,\r\n\t\t\ttype: cc.AudioClip\r\n\t\t}\r\n\t},\r\n\r\n\tonLoad: function () {\r\n\t\tthis.enabled = false;\r\n\r\n\t\t// 加速度方向开关\r\n\t\tthis.accLeft = false;\r\n\t\tthis.accRight = false;\r\n\t\t// 主角当前水平方向速度\r\n\t\tthis.xSpeed = 0;\r\n\r\n\t\t// 获取屏幕边界\r\n\t\tthis.minPosX = -this.node.parent.width / 2;\r\n\t\tthis.maxPosX = this.node.parent.width / 2;\r\n\r\n\t\t// 初始化跳跃动作\r\n\t\tthis.jumpAction = this.setJumpAction();\r\n\t\t// this.node.runAction(this.jumpAction);\r\n\r\n\t\t// 初始化键盘输入监听\r\n\t\tcc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n\t\tcc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\r\n\t},\r\n\r\n\tonDestroy() {\r\n\t\t// 取消键盘输入监听\r\n\t\tcc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n\t\tcc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\r\n\t},\r\n\r\n\tonKeyDown(event) {\r\n\t\t// console.log(event,'event')\r\n\t\t// console.log(cc.macro.KEY)\r\n\t\tswitch (event.keyCode) {\r\n\t\t\tcase cc.macro.KEY.a:\r\n\t\t\tcase cc.macro.KEY.left:\r\n\t\t\t\tthis.accLeft = true;\r\n\t\t\t\tthis.accRight = false\r\n\t\t\t\tbreak;\r\n\t\t\tcase cc.macro.KEY.d:\r\n\t\t\tcase cc.macro.KEY.right:\r\n\t\t\t\tthis.accRight = true;\r\n\t\t\t\tthis.accLeft = false;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t},\r\n\tonKeyUp(event) {\r\n\t\tswitch (event.keyCode) {\r\n\t\t\tcase cc.macro.KEY.a:\r\n\t\t\tcase cc.macro.KEY.left:\r\n\t\t\t\tthis.accLeft = false;\r\n\t\t\t\tbreak;\r\n\t\t\tcase cc.macro.KEY.d:\r\n\t\t\tcase cc.macro.KEY.right:\r\n\t\t\t\tthis.accRight = false;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t},\r\n\r\n\tonTouchStart(event) {\r\n\t\tvar touchLoc = event.getLocation();\r\n\t\tconsole.log(touchLoc,'touchLoc')\r\n\t\tif (touchLoc.x >= cc.winSize.width / 2) {\r\n\t\t\tthis.accLeft = false;\r\n\t\t\tthis.accRight = true;\r\n\t\t} else {\r\n\t\t\tthis.accLeft = true;\r\n\t\t\tthis.accRight = false;\r\n\t\t}\r\n\t},\r\n\r\n\tonTouchEnd(event) {\r\n\t\tthis.accLeft = false;\r\n\t\tthis.accRight = false;\r\n\t},\r\n\r\n\tsetJumpAction() {\r\n\t\t// 跳跃上升\r\n\t\tconst jumpUp = cc.moveBy(this.jumpDuration, cc.v2(0, this.jumpHeight)).easing(cc.easeCubicActionOut())\r\n\t\t// 下降\r\n\t\tconst jumpDown = cc.moveBy(this.jumpDuration, cc.v2(0, -this.jumpHeight)).easing(cc.easeCubicActionIn())\r\n\t\t// 添加回调函数 用于在动作结束后播放音频\r\n\t\tvar callback = cc.callFunc(this.playJumpSound, this)\r\n\t\t// 不断重复, 每次完成落地动作后 调用回调来播放声音\r\n\t\treturn cc.repeatForever(cc.sequence(jumpUp, jumpDown, callback));\r\n\t},\r\n\tplayJumpSound() {\r\n\t\tcc.audioEngine.playEffect(this.jumpAudio, false);\r\n\t},\r\n\r\n\tgetCenterPos() {\r\n\t\tvar centerPos = cc.v2(this.node.x, this.node.y + this.node.height / 2);\r\n\t\treturn centerPos;\r\n\t},\r\n\r\n\t// player 开始移动\r\n\tstartMoveAt(pos) {\r\n\t\tthis.enabled = true;\r\n\t\tthis.xSpeed = 0;\r\n\t\tthis.node.setPosition(pos);\r\n\t\tthis.node.runAction(this.jumpAction);\r\n\t},\r\n\r\n\t// 停止移动\r\n\tstopMove: function () {\r\n\t\tthis.node.stopAllActions();\r\n\t\tthis.enabled = false;\r\n\t},\r\n\r\n\tstart() {\r\n\r\n\t},\r\n\r\n\tupdate(dt) {\r\n\t\t// 根据当前加速度方向每帧更新速度\r\n\t\tif (this.accLeft) {\r\n\t\t\tthis.xSpeed -= this.accel * dt\r\n\t\t} else if (this.accRight) {\r\n\t\t\tthis.xSpeed += this.accel * dt\r\n\t\t}\r\n\r\n\t\t// 限制速度最大值\r\n\t\tif (Math.abs(this.xSpeed) > this.maxMoveSpeed) {\r\n\t\t\tthis.xSpeed = this.maxMoveSpeed * this.xSpeed / Math.abs(this.xSpeed)\r\n\t\t}\r\n\r\n\t\t// 根据速度更新 player 位置\r\n\t\tthis.node.x += this.xSpeed * dt\r\n\r\n\t\t// 限制 player 在屏幕内移动\r\n\t\tif(this.node.x>=this.node.parent.width/2){\r\n\t\t\tthis.node.x = this.node.parent.width/2\r\n\t\t\tthis.xSpeed = 0;\r\n\t\t}else if (this.node.x<-this.node.parent.width/2){\r\n\t\t\tthis.node.x = -this.node.parent.width/2\r\n\t\t\tthis.xSpeed = 0;\r\n\t\t}\r\n\t},\r\n});\r\n"]}